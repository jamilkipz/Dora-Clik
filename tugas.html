<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tugas - Bird Money</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { 
            background: linear-gradient(135deg, #4B0082 0%, #6B21A8 50%, #7C3AED 100%);
            min-height: 100vh;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .task-card {
            background: linear-gradient(135deg, #1e1e2e 0%, #2d2d44 100%);
            border: 1px solid rgba(249, 115, 22, 0.3);
            transition: all 0.3s ease;
        }
        .task-card:hover {
            transform: translateY(-2px);
            border-color: rgba(249, 115, 22, 0.6);
            box-shadow: 0 10px 30px rgba(249, 115, 22, 0.2);
        }
        .task-completed {
            opacity: 0.6;
            background: linear-gradient(135deg, #1a1a2e 0%, #252538 100%);
        }
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to bottom, #f36d21, #e33b2a);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 10px 5px;
            border-top: 2px solid rgba(255,255,255,0.2);
            border-radius: 25px 25px 0 0;
            z-index: 1000;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: #fff;
            flex: 1;
        }
        .nav-item img {
            width: 32px;
            height: 32px;
            margin-bottom: 2px;
            object-fit: contain;
        }
        .nav-item span {
            font-size: 12px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        .nav-item.active::before {
            content: '';
            position: absolute;
            top: -10px;
            width: 30px;
            height: 4px;
            background: #ffeb3b;
            border-radius: 10px;
            box-shadow: 0 0 10px #ffeb3b;
        }
        .nav-item.active {
            position: relative;
        }
        .progress-ring {
            transform: rotate(-90deg);
        }
        .animate-pulse-glow {
            animation: pulseGlow 2s ease-in-out infinite;
        }
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 5px rgba(249, 115, 22, 0.5); }
            50% { box-shadow: 0 0 20px rgba(249, 115, 22, 0.8); }
        }
    </style>
</head>
<body class="text-white font-sans antialiased pb-24">
    
    <div class="p-4 pt-6">
        <div class="flex items-center justify-between mb-6">
            <h1 class="text-2xl font-black">Tugas Harian</h1>
            <div class="glass-card px-4 py-2 rounded-full">
                <span class="text-sm font-bold"><i class="fas fa-calendar-day mr-2 text-orange-400"></i><span id="current-date"></span></span>
            </div>
        </div>

        <div class="glass-card rounded-3xl p-5 mb-6">
            <div class="flex items-center justify-between mb-4">
                <div>
                    <p class="text-sm opacity-80">Progress Hari Ini</p>
                    <p class="text-3xl font-black text-orange-400"><span id="completed-tasks">0</span>/<span id="total-tasks">0</span></p>
                </div>
                <div class="relative">
                    <svg class="progress-ring w-20 h-20">
                        <circle cx="40" cy="40" r="35" stroke="rgba(255,255,255,0.2)" stroke-width="6" fill="none"/>
                        <circle id="progress-circle" cx="40" cy="40" r="35" stroke="#f97316" stroke-width="6" fill="none" 
                                stroke-dasharray="220" stroke-dashoffset="220" stroke-linecap="round"/>
                    </svg>
                    <span id="progress-percent" class="absolute inset-0 flex items-center justify-center text-lg font-bold">0%</span>
                </div>
            </div>
            <div class="bg-black/30 rounded-2xl p-4">
                <div class="flex items-center gap-3">
                    <div class="bg-yellow-500 w-12 h-12 rounded-xl flex items-center justify-center">
                        <i class="fas fa-gift text-xl"></i>
                    </div>
                    <div>
                        <p class="text-sm opacity-80">Bonus Harian</p>
                        <p class="text-xl font-black text-yellow-400" id="daily-bonus">0 Koin</p>
                    </div>
                </div>
            </div>
        </div>

        <h2 class="text-lg font-bold mb-4">Daftar Tugas</h2>
        
        <div id="tasks-container" class="space-y-4">
            <!-- Tasks will be loaded here -->
        </div>

        <button id="claim-daily" onclick="claimDailyBonus()" class="hidden w-full mt-6 bg-gradient-to-r from-yellow-500 to-orange-500 py-4 rounded-2xl font-bold text-lg shadow-xl animate-pulse-glow">
            <i class="fas fa-gift mr-2"></i> Klaim Bonus Harian
        </button>
    </div>

    <nav class="bottom-nav">
        <a href="home.html" class="nav-item">
            <img src="https://cdn-icons-png.flaticon.com/512/1946/1946436.png" alt="Home">
            <span>Home</span>
        </a>
        <a href="Tugas.html" class="nav-item active">
            <img src="https://cdn-icons-png.flaticon.com/512/2645/2645850.png" alt="Tugas">
            <span>Tugas</span>
        </a>
        <a href="invite.html" class="nav-item">
            <img src="https://cdn-icons-png.flaticon.com/512/2583/2583158.png" alt="Invite">
            <span>Invite</span>
        </a>
        <a href="withdraw.html" class="nav-item">
            <img src="https://cdn-icons-png.flaticon.com/512/2489/2489756.png" alt="Tarik">
            <span>Tarik</span>
        </a>
        <a href="profil.html" class="nav-item">
            <img src="https://cdn-icons-png.flaticon.com/512/3033/3033143.png" alt="Profil">
            <span>Profil</span>
        </a>
    </nav>

    <div id="modal-claim" class="fixed inset-0 bg-black/80 backdrop-blur-md flex items-center justify-center z-[100] hidden p-6">
        <div class="bg-gradient-to-br from-yellow-500 to-orange-600 w-full max-w-xs rounded-[35px] p-8 text-center shadow-2xl border-2 border-white/30">
            <div class="bg-white/20 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-check text-white text-4xl"></i>
            </div>
            <h2 class="text-2xl font-black text-white mb-2">Bonus Diklaim!</h2>
            <p class="text-sm opacity-90 mb-4">Anda mendapatkan bonus harian</p>
            <div class="bg-white/20 py-3 px-6 rounded-2xl inline-flex items-center gap-2 mb-6">
                <i class="fas fa-coins text-yellow-300 text-xl"></i>
                <span id="claimed-bonus" class="text-2xl font-black text-white">500 Koin</span>
            </div>
            <button onclick="closeClaimModal()" class="w-full bg-white/20 border border-white/30 py-3 rounded-2xl font-bold">Tutup</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getDatabase, ref, onValue, update, set } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCgNKaGKhvNx34CK2N8r979Y1WSrfBqh48",
            authDomain: "bird-money-85873.firebaseapp.com",
            databaseURL: "https://bird-money-85873-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "bird-money-85873",
            storageBucket: "bird-money-85873.appspot.com",
            messagingSenderId: "147773799872",
            appId: "1:147773799872:web:3922142ffedbae9f0d1c25"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        let currentUser = null;
        let userData = null;

        const tasks = [
            { id: 'login', title: 'Login Harian', desc: 'Login ke aplikasi setiap hari', reward: 100, icon: 'fa-sign-in-alt', color: 'bg-blue-500' },
            { id: 'tap50', title: 'Tap 50 Kali', desc: 'Tap burung 50 kali dalam sehari', reward: 200, icon: 'fa-hand-pointer', color: 'bg-orange-500' },
            { id: 'tap100', title: 'Tap 100 Kali', desc: 'Tap burung 100 kali dalam sehari', reward: 300, icon: 'fa-hand-pointer', color: 'bg-red-500' },
            { id: 'invite1', title: 'Undang 1 Teman', desc: 'Bagikan kode referral Anda', reward: 500, icon: 'fa-user-plus', color: 'bg-green-500' },
            { id: 'watch_ad', title: 'Tonton Iklan', desc: 'Tonton 3 video iklan', reward: 150, icon: 'fa-play-circle', color: 'bg-purple-500' },
            { id: 'share', title: 'Bagikan ke Sosmed', desc: 'Bagikan aplikasi ke media sosial', reward: 250, icon: 'fa-share-alt', color: 'bg-pink-500' }
        ];

        document.getElementById('current-date').innerText = new Date().toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long' });

        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                onValue(ref(db, 'users/' + user.uid), (snapshot) => {
                    userData = snapshot.val();
                    if (userData) {
                        renderTasks();
                        checkDailyBonus();
                    }
                });
            } else {
                window.location.href = "index.html";
            }
        });

        function renderTasks() {
            const container = document.getElementById('tasks-container');
            const completedTasks = userData.tasksCompleted || {};
            const dailyTaps = userData.dailyTaps || 0;
            const totalInvites = userData.totalInvites || 0;

            let completed = 0;

            container.innerHTML = tasks.map(task => {
                const isCompleted = completedTasks[task.id] === true;
                if (isCompleted) completed++;

                let progress = '';
                if (task.id === 'tap50') {
                    const prog = Math.min(dailyTaps, 50);
                    progress = `<span class="text-xs opacity-70">${prog}/50</span>`;
                } else if (task.id === 'tap100') {
                    const prog = Math.min(dailyTaps, 100);
                    progress = `<span class="text-xs opacity-70">${prog}/100</span>`;
                }

                return `
                    <div class="task-card ${isCompleted ? 'task-completed' : ''} rounded-2xl p-4">
                        <div class="flex items-center gap-4">
                            <div class="${task.color} w-14 h-14 rounded-xl flex items-center justify-center shadow-lg">
                                <i class="fas ${task.icon} text-xl"></i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-bold">${task.title} ${progress}</h3>
                                <p class="text-xs opacity-70">${task.desc}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-yellow-400 font-bold text-sm">+${task.reward}</p>
                                <p class="text-xs opacity-70">Koin</p>
                            </div>
                        </div>
                        <button onclick="completeTask('${task.id}', ${task.reward})" 
                                class="${isCompleted ? 'bg-gray-600 cursor-not-allowed' : 'bg-gradient-to-r from-orange-500 to-yellow-500'} w-full py-2 rounded-xl font-bold text-sm mt-3 transition"
                                ${isCompleted ? 'disabled' : ''}>
                            ${isCompleted ? '<i class="fas fa-check mr-2"></i>Selesai' : 'Kerjakan'}
                        </button>
                    </div>
                `;
            }).join('');

            document.getElementById('completed-tasks').innerText = completed;
            document.getElementById('total-tasks').innerText = tasks.length;

            const percent = Math.round((completed / tasks.length) * 100);
            document.getElementById('progress-percent').innerText = percent + '%';
            
            const circle = document.getElementById('progress-circle');
            const offset = 220 - (220 * percent / 100);
            circle.style.strokeDashoffset = offset;

            const totalBonus = tasks.reduce((sum, t) => sum + t.reward, 0);
            const earnedBonus = tasks.filter(t => completedTasks[t.id]).reduce((sum, t) => sum + t.reward, 0);
            document.getElementById('daily-bonus').innerText = earnedBonus + ' / ' + totalBonus + ' Koin';
        }

        function checkDailyBonus() {
            const completedTasks = userData.tasksCompleted || {};
            const allCompleted = tasks.every(t => completedTasks[t.id]);
            const dailyClaimed = userData.dailyBonusClaimed || false;

            if (allCompleted && !dailyClaimed) {
                document.getElementById('claim-daily').classList.remove('hidden');
            }
        }

        window.completeTask = function(taskId, reward) {
            const completedTasks = userData.tasksCompleted || {};
            if (completedTasks[taskId]) return;

            const updates = {};
            updates[`tasksCompleted/${taskId}`] = true;
            updates['saldo'] = (userData.saldo || 0) + reward;

            update(ref(db, 'users/' + currentUser.uid), updates).then(() => {
                // Success feedback
            });
        };

        window.claimDailyBonus = function() {
            const bonus = 500;
            update(ref(db, 'users/' + currentUser.uid), {
                saldo: (userData.saldo || 0) + bonus,
                dailyBonusClaimed: true
            }).then(() => {
                document.getElementById('claimed-bonus').innerText = bonus + ' Koin';
                document.getElementById('modal-claim').classList.remove('hidden');
                document.getElementById('claim-daily').classList.add('hidden');
            });
        };

        window.closeClaimModal = function() {
            document.getElementById('modal-claim').classList.add('hidden');
        };
    </script>
</body>
</html>